<!DOCTYPE html>
<html>
<style>
    .container {
        position:relative;
        left:0;
        right: 0;
        width: 100%;
        max-width:100% !important;
    }

    .row {
        margin-right:15px;
        margin-left: 15px;
    }

    /*.instrumentCards {
        display:inline-flex;
        width: 100%;
    }*/
    .instrumentCard {
        height:400px;
        text-align:center;
        border: 1px solid black;
        width: 24%;
        margin-right: 1%;
        margin-bottom: 1%;
    }
    .filters {
        background-color:blue;
    }

    .instrumentImage {
        max-width: 100%;
        margin-top:5px;
        max-height:70%;
        min-height:70%;
    }

    .instrumentName {
        margin-top: -30px;
        font-size:35px;
    }
    .instrumentDescription {
        font-size:25px;
        margin-top: -3px;
    }
    .instrumentPrice {
        font-size:30px;
        margin-top: 5px;
    }

    .instrumentPrice::after {
        content:"₪";
    }
</style>
<head>
    <meta charset="utf-8" />
    <title></title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="main-content">
                <div class="col-xs-12 col-sm-12 col-md-10 col-lg-10">
                    <div id="instrumentList" class="row instrumentList">
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
                    <div class="filter" dir="rtl">
                        <h3 class="filter_title">סינון</h3>
                        <h4 class="heading">מחיר</h4>
                        <div class="scrollbar-prop">
                            <ul class="list-unstyled">
                                <li class="in_range">
                                    <label>
                                        <input over="0" under="500" type="checkbox" class="checkbox" role="checkbox" onclick="">עד 500 ₪
                                    </label>
                                </li>
                                <li class="in_range">
                                    <label>
                                        <input over="500" under="1000" name="" type="checkbox" class="checkbox" role="checkbox" onclick="">500-1000 ₪
                                    </label>
                                </li>
                                <li class="in_range">
                                    <label>
                                        <input over="1000" under="1500" type="checkbox" class="checkbox" role="checkbox" onclick="">1000-1500 ₪
                                    </label>
                                </li>
                                <li class="in_range">
                                    <label>
                                        <input over="1500" under="2000" type="checkbox" class="checkbox" role="checkbox" onclick="">1500-2000 ₪
                                    </label>
                                </li>
                                <li class="in_range">
                                    <label>
                                        <input over="2000" under="99999999" type="checkbox" class="checkbox" role="checkbox" onclick="">2000 ומעלה
                                    </label>
                                </li>
                            </ul><input type="hidden" id="72709_F15621" value="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>      

    <script>
        $(document).ready(async () => {
            var allInstruments = await getAllInstruments();
            createInstruments(allInstruments);
            var filters = [];
            $('input').on('click', (event) => {
                var target = event.target;
                var over = target.getAttribute('over');
                var under = target.getAttribute('under');
                $("#instrumentList").empty();
                if (target.checked) {
                    filters.push({ over, under })
                } else {
                    filters = filters.filter(filter => !(filter.over == over && filter.under == under));
                }
                if (filters.length == 0) {
                    createInstruments(allInstruments);
                } else {
                    createInstruments(filterInstruments(allInstruments, filters))
                }
            })
        });
 
         const getAllInstruments = async () => {
            return await $.ajax({
                url: "/Instruments/list",
                success: function (instruments, status, xhr) {
                    return instruments;
                },
                error: function(xhr, status,err) {
                    console.log("fail");
                    return [];
                }
            })
        }

        const createInstruments = (instruments) => {
            for (instrument of instruments) {
                var instrumentCard = document.createElement("div");
                instrumentCard.className = "instrumentCard col-xs-6 col-sm-4 col-md-3 col-lg-5ths";
                var instrumentImg = document.createElement("img");
                instrumentImg.className = "instrumentImage";
                //console.log()
                instrumentImg.setAttribute("src", '/Images/' + instrument.imagePath)
                var instrumentName = document.createElement("div");
                instrumentName.className = "instrumentName";
                instrumentName.innerHTML = instrument.name;
                var instrumentDescription = document.createElement("div");
                instrumentDescription.className = "instrumentDescription";
                instrumentDescription.innerHTML = instrument.description;
                var instrumentPrice = document.createElement("div");
                instrumentPrice.className = "instrumentPrice";
                instrumentPrice.innerHTML = instrument.price;
                instrumentCard.appendChild(instrumentImg);
                instrumentCard.appendChild(instrumentName);
                instrumentCard.appendChild(instrumentDescription);
                instrumentCard.appendChild(instrumentPrice);
                $("#instrumentList").append(instrumentCard)
            }
        }

        const filterInstruments = (instruments, filters) => {
            var filteredInstruments = instruments.filter(instrument => {
                for (filter of filters) {
                    if (instrument.price > filter.over && instrument.price <= filter.under) {
                        return instrument;
                    }
                }
            })
            return filteredInstruments;
        }
    </script>
</body>
</html>